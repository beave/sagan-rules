# Sagan windows-auth.rules
# Copyright (c) 2009-2014, Quadrant Information Security <www.quadrantsec.com>
# All rights reserved.
#
# Please submit any custom rules or ideas to sagan-submit@quadrantsec.com or the sagan-sigs mailing list
#
#*************************************************************
#  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
#  following conditions are met:
#
#  * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
#    disclaimer.
#  * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the
#    following disclaimer in the documentation and/or other materials provided with the distribution.
#  * Neither the name of the nor the names of its contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#*************************************************************
# Windows authentication rules. 
# Eventlog to syslog service.  This is what we primarily use.
# http://code.google.com/p/eventlog-to-syslog/


alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - Unknown username or bad password - Brute force"; content: " 529: "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 10, seconds 300; threshold: type limit, track by_src, count 2, seconds 300; fwsam: src, 1 day; parse_src_ip: 1; parse_port; reference: url,wiki.quadrantsec.com/bin/view/Main/5001151; sid: 5001151; rev:8;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - Unknown username or bad password"; content: " 529: "; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001531; sid: 5001531; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - Account login time restriction"; content: " 530: "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001152; sid: 5001152; rev:3;)

# We only want disabled users that contain usernames, hence the content:! on sid 5001153.

alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - Account currently disabled"; content: " 531: "; content:!"User Name|3a| Domain|3a|"; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001153; sid: 5001153; rev:4;)

#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - Specified account expired"; content: " 532: "; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001154; sid: 5001154; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - User not allowed to login at this computer"; content: " 533: "; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001155; sid: 5001155; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - User not granted login type"; content: " 534: "; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001156; sid: 5001156; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - Account password is expired"; content: " 535: "; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001157; sid: 5001157; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - Internal error"; pcre: "/ 536: | 537: /"; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 10, seconds 300; threshold: type limit, track by_src, count 2, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001158; sid: 5001158; rev:6;)
drop syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Login failure - Account locked"; content: " 539: "; classtype: unsuccessful-user; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; parse_port; fwsam: src, 1 day; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001159; sid: 5001159; rev:4;)

# See 681 & 4769 for subcodes

#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force"; pcre: "/ 675: | 676: | 681: /"; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 10, seconds 300; threshold: type limit, track by_src, count 2, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001160; sid: 5001160; rev:6;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] User account unlocked"; pcre: "/ 671: | 4767: /"; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001161; sid: 5001161; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled group created"; pcre: "/ 631: | 635: | 658: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001162; sid: 5001162; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled group deleted"; pcre: "/ 634: | 638: | 662: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001163; sid: 5001163; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Group account created"; pcre: "/ 631: | 4727: | 635: | 4731: | 658: | 4754: | 648: | 4744: | 653: | 4749: | 663: | 4759: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001164; sid: 5001164; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Group account deleted"; pcre: "/ 634: | 4730: | 638: | 4734: | 662: | 4758: | 652: | 4748: | 657: | 4753: | 667: | 4763: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001165; sid: 5001165; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Group account changed"; pcre: "/ 632: | 4728: | 633: | 4729: | 636: | 4732: | 637: | 4733: | 639: | 4735: | 641 | 4737: | 637: | 4733: | 659: | 4755: | 660: | 4766: | 668: | 4764: | 649: | 4745: | 650: | 4746: | 651: | 4747: | 654: | 4750: | 655: | 4751: | 656: | 4752: | 659: | 4755: | 660: | 4756: | 661: | 4757: | 664: | 4760: | 665: | 4761: | 666: | 4762: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001475; sid: 5001475; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled global group member added"; pcre: "/ 632: | 4728: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001166; sid: 5001166; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled global group member removed"; pcre: "/ 633: | 4729: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001167; sid: 5001167; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled global group deleted"; pcre: "/ 634: | 4730: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001168; sid: 5001168; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled global group created"; pcre: "/ 635: | 4731: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001169; sid: 5001169; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled local group member added"; pcre: "/ 636: | 4732: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001170; sid: 5001170; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled local group member removed"; pcre: "/ 637: | 4733: /"; classtype: system-eventr; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001171; sid: 5001171; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled local group deleted"; pcre: "/ 638: | 4734: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001172; sid: 5001172; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled local group changed"; pcre: "/ 639: | 4735: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001173; sid: 5001173; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled group changed"; pcre: "/ 641: | 4737: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001174; sid: 5001174; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled universal group created"; pcre: "/ 658: | 4754: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001176; sid: 5001176; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled universal group changed"; pcre: "/ 659: | 4755: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001177; sid: 5001177; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled universal group member added"; pcre: "/ 660: | 4756: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001178; sid: 5001178; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled group member removed"; pcre: "/ 661: | 4757: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001179; sid: 5001179; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Security enabled group member deleted"; pcre: "/ 662: | 4758: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001180; sid: 5001180; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] RDP maximum allowed failed logon attempts"; content: " 1012: "; classtype: system-event; program: TermService; reference: url,wiki.quadrantsec.com/bin/view/Main/5001181; sid: 5001181; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows login attempt (ignored). Duplicated"; content: " 680: "; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001186; sid: 5001186; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Remote access login failure"; pcre: "/ 20187: | 20014: | 20078: | 20050: | 20049: | 20189: /"; classtype: unsuccessful-user; program: RemoteAccess; reference: url,wiki.quadrantsec.com/bin/view/Main/5001187; sid: 5001187; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Remote access login success"; content: " 20158: "; classtype: successful-user; program: RemoteAccess; reference: url,wiki.quadrantsec.com/bin/view/Main/5001188; sid: 5001188; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Computer account changed/deleted"; pcre: "/ 646: | 647: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001189; sid: 5001189; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Computer account changed/deleted"; pcre: "/ 646: | 647: /"; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001190; sid: 5001190; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Account locked out (multiple login errors)"; pcre: "/ 644: | 4740: /"; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001192; sid: 5001192; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] General account database changed"; content: " 640: "; classtype: system-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001193; sid: 5001193; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] DC  - Integrity check on decrypted"; pcre: "/ 675: | 676: | 681: /"; content: "Failure Code: 0x1F"; classtype: exploit-attempt; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001195; sid: 5001195; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] DC - Possible replay attack"; pcre: "/ 675: | 676: | 681: /"; content: "Failure Code: 0x22"; classtype: exploit-attempt; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001196; sid: 5001196; rev:2;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] DC - Clock skew too great"; pcre: "/ 675: | 676: | 681: /"; content: "Failure Code: 0x25"; classtype: exploit-attempt; parse_src_ip: 1; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001197; sid: 5001197; rev:4;)

# Tied to SIDs.

#if_sid 18207,18208 - see msauth rules.  Sagan can do the same,  rules just need to be written.
# Same with "Kerberos failures that may indicate an attack"
#
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Administrator group changed"; pcre: "/ ID:\s+\p*S-1-5-32-544\p*/"; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/XXXXXXX; sid: XXXXXXX; rev:2;)

# 09/18/2012 Sniffty Dugen 

#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Attempted Password Reset"; content: " 4724: "; classtype: configuration-change; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001620; sid:5001620; rev:2;) 

# Generic "catch all" for event ID 6273
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Authentication failed - User credentials mismatch"; content: " 6273: "; classtype: unsuccessful-user; program: Security|Security-Auditing; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001648; sid: 5001648; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Auth failed - Bad Account/Incorrect Password - Brute Force"; content: " 6273: "; content: "Reason Code: 16 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001657; sid: 5001657; rev:3;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Auth failed - Bad Account/Incorrect Password"; content: " 6273: "; content: "Reason Code: 16 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001658; sid: 5001658; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] User account does not exist"; content: " 6273: "; content: "Reason Code: 8 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001659; sid: 5001659; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Domain does not exist"; content: " 6273: "; content: "Reason Code: 7 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001660; sid: 5001660; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] No matching newtork policy"; content: " 6273: "; content: "Reason Code: 48 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001661; sid: 5001661; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] RADIUS Access-Request message is disabled"; content: " 6273: "; content: "Reason Code: 34 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001662; sid: 5001662; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] User much change password"; content: " 6273: "; content: "Reason Code: 33 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001663; sid: 5001663; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Remote RADIUS did not process auth request"; content: " 6273: "; content: "Reason Code: 112 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001664; sid: 5001664; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Incomplete message. Signature not verified"; content: " 6273: "; content: "Reason Code: 262 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001665; sid: 5001665; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] EAP type cannot be processed by server"; content: " 6273: "; content: "Reason Code: 22 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001666; sid: 5001666; rev:2;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Error occured with EAP"; content: " 6273: "; content: "Reason Code: 23 "; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001667; sid: 5001667; rev:2;)

# Group change rules where typically to noisy and didn't supply the information
# Needed.  These rule detect "what" group a user was "added" to.  This should
# reduce the signal/noise ratio greatly. 
#
# These where created by Robert Nunley (rnunley@quadrantsec.com)

# Local group
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] Local Administrator account added to a local group"; pcre: "/ 636: | 4732: /"; pcre: "/S-1-5-21-\d{5,15}\-\d{5,15}\-\d{5,15}-500 /"; program: Security|Security-Auditing; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5001692; sid: 5001692; rev:4;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] User added to Network Config Operator group";  pcre: "/ 636: | 4732: /"; pcre: "/S-1-5-21-\d{5,15}\-\d{5,15}\-\d{5,15}-556 /"; program: Security|Security-Auditing; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5001693; sid: 5001693; rev:4;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] User added to DNS Admins group";  pcre: "/ 636: | 4732: /"; pcre: "/S-1-5-21-\d{5,15}\-\d{5,15}\-\d{5,15}-1101 /"; program: Security|Security-Auditing; classtype: successful-admin; reference: url,wiki.quadrantsec.com/bin/view/Main/5001694; sid: 5001694; rev:3;)
# Domain/global group
alert syslog $EXTERNAL_NET any -> $HOME_NET 389 (msg:"[WINDOWS-AUTH] User added to Domain Administrators group";  pcre: "/ 632: | 4728: /"; pcre: "/S-1-5-21-\d{5,15}\-\d{5,15}\-\d{5,15}-512 /"; program: Security|Security-Auditing; classtype: successful-admin; reference: url,wiki.quadrantsec.com/bin/view/Main/5001695; sid: 5001695; rev:4;)
# Enterprise/universal group
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] User added to Enterprise Administrators group"; pcre: "/ 660: | 4756: /"; pcre: "/S-1-5-21-\d{5,15}\-\d{5,15}\-\d{5,15}-519 /"; program: Securty|Security-Auditing; classtype: successful-admin; reference: url,wiki.quadrantsec.com/bin/view/Main/5001696; sid: 5001696; rev:4;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] User added to Group Policy Creator Owner group"; pcre: "/ 660: | 4756: /"; pcre: "/S-1-5-21-\d{5,15}\-\d{5,15}\-\d{5,15}-520 /"; program: Security|Security-Auditing; classtype: successful-admin; reference: url,wiki.quadrantsec.com/bin/view/Main/5001696; sid: 5001697; rev:4;)
# User enabled
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] User account enabled"; content: " 4722: "; program: Security|Security-Auditing; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5001687; sid: 5001687; rev:3;) 

# User created
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] User account created"; content: " 4720: "; program: Security|Security-Auditing; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5001786; sid: 5001791; rev:1;)

# Windows 2008 rules submitted by Robert Nunley (rnunley@quadrantsec.com)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Potential Windows User Enumeration - User Name Does Not Exist [Brute Force]"; content: " 4625: "; content: "C0000064"; nocase; content:!"$ Source"; classtype: unsuccessful-user; program: Security|Security-Auditing; parse_src_ip: 1; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; reference: url,wiki.quadrantsec.com/bin/view/Main/5001728; sid: 5001728; rev:7;)

alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows Brute force - User Correct but Incorrect Password"; content: " 4625: "; content: "C000006A"; nocase; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001729; sid: 5001729; rev:4;)

alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows Brute force - User Is Locked Out"; content: " 4625: "; content: "C0000234"; nocase; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001730; sid: 5001730; rev:4;)

alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows Brute force - User Account Disabled"; content: " 4625: "; content: "C0000072"; nocase; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001731; sid: 5001731; rev:4;)

alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows Brute force - User Login Attempts Outside of Time Restriction"; content: " 4625: "; content: "C000006F"; nocase; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001732; sid: 5001732; rev:4;)

#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows Brute force - Expired Account"; content: " 4625: "; content: "C0000193"; nocase; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001733; sid: 5001733; rev:3;)

#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows Brute force - Expired Password"; content: " 4625: "; content: "C0000071"; nocase; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001734; sid: 5001734; rev:4;)

# Windows authentication rules by code type.  Submitted by Brian Echeverry

#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x1 - Client's entry in database has expired"; pcre: "/ 675: | 676: | 681: /"; content: " 0x1 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001740; sid: 50017240; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x2 - Server's entry in database has expired"; pcre: "/ 675: | 676: | 681: /"; content: " 0x2 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001741; sid: 5001741; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x3 - Requested protocol version # not supported"; pcre: "/ 675: | 676: | 681: /"; content: " 0x3 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001742; sid: 5001742; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x4 - Client's key encrypted in old master key"; pcre: "/ 675: | 676: | 681: /"; content: " 0x4 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001743; sid: 5001743; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x5 - Server's key encrypted in old master key"; pcre: "/ 675: | 676: | 681: /"; content: " 0x5 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001744; sid: 5001744; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x6 - Client not found in Kerberos database"; pcre: "/ 675: | 676: | 681: /"; content: " 0x6 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001745; sid: 5001745; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x7 - Server not found in Kerberos database"; pcre: "/ 675: | 676: | 681: /"; content: " 0x7 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001746; sid: 5001746; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x8 - Multiple principal entries in database"; pcre: "/ 675: | 676: | 681: /"; content: " 0x8 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001747; sid: 5001747; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x9 - The client or server has a null key"; pcre: "/ 675: | 676: | 681: /"; content: " 0x9 Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001748; sid: 5001748; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0xA - Ticket not eligible for postdating"; pcre: "/ 675: | 676: | 681: /"; content: " 0xA Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001749; sid: 5001749; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0xB - Requested start time is later than end time"; pcre: "/ 675: | 676: | 681: /"; content: " 0xB Client "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001750; sid: 5001750; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0xC - KDC policy rejects request"; pcre: "/ 675: | 676: | 681: /"; content: " 0xC "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001751; sid: 5001751; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0xD - KDC cannot accommodate requested option"; pcre: "/ 675: | 676: | 681: /"; content: " 0xD "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001752; sid: 5001752; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0xE - KDC has no support for encryption type"; pcre: "/ 675: | 676: | 681: /"; content: " 0xE "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001753; sid: 5001753; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0xF - KDC has no support for checksum type"; pcre: "/ 675: | 676: | 681: /"; content: " 0xF "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001754; sid: 5001754; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x10 - KDC has no support for padata type"; pcre: "/ 675: | 676: | 681: /"; content: " 0x10 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001755; sid: 5001755; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x11 - KDC has no support for transited type"; pcre: "/ 675: | 676: | 681: /"; content: " 0x11 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001756; sid: 5001756; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x12 - Clients credentials have been revoked"; pcre: "/ 675: | 676: | 681: /"; content: " 0x12 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001757; sid: 5001757; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x13 - Credentials for server have been revoked"; pcre: "/ 675: | 676: | 681: /"; content: " 0x13 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001758; sid: 5001758; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x14 - TGT has been revoked"; pcre: "/ 675: | 676: | 681: /"; content: " 0x14 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001759; sid: 5001759; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x15 - Client not yet valid - try again later"; pcre: "/ 675: | 676: | 681: /"; content: " 0x15 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001760; sid: 5001760; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x16 - Server not yet valid - try again later"; pcre: "/ 675: | 676: | 681: /"; content: " 0x16 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001761; sid: 5001761; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x17 - Password has expired"; pcre: "/ 675: | 676: | 681: /"; content: " 0x17 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001762; sid: 5001762; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x18 - Pre-authentication information was invalid"; pcre: "/ 675: | 676: | 681: /"; content: " 0x18 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001763; sid: 5001763; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x19 - Additional pre-authentication required"; pcre: "/ 675: | 676: | 681: /"; content: " 0x19 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001764; sid: 5001764; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x1F - Integrity check on decrypted field failed"; pcre: "/ 675: | 676: | 681: /"; content: " 0x1F "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001765; sid: 5001765; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x20 - Ticket expired"; pcre: "/ 675: | 676: | 681: /"; content: " 0x20 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001766; sid: 5001766; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x21 - Ticket not yet valid"; pcre: "/ 675: | 676: | 681: /"; content: " 0x21 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001767; sid: 5001767; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x22 - Request is a replay"; pcre: "/ 675: | 676: | 681: /"; content: " 0x22 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001768; sid: 5001768; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x23 - The ticket isn't for us"; pcre: "/ 675: | 676: | 681: /"; content: " 0x23 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001769; sid: 5001769; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x24 - Ticket and authenticator don't match"; pcre: "/ 675: | 676: | 681: /"; content: " 0x24 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001770; sid: 5001770; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x25 - Clock skew too great"; pcre: "/ 675: | 676: | 681: /"; content: " 0x25 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001771; sid: 5001771; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x26 - Incorrect net address"; pcre: "/ 675: | 676: | 681: /"; content: " 0x26 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001772; sid: 5001772; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x27 - Protocol version mismatch"; pcre: "/ 675: | 676: | 681: /"; content: " 0x27 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001773; sid: 5001773; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x28 - Invalid msg type"; pcre: "/ 675: | 676: | 681: /"; content: " 0x28 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001774; sid: 5001774; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x29 - Message stream modified"; pcre: "/ 675: | 676: | 681: /"; content: " 0x29 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001775; sid: 5001775; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x2A - Message out of order"; pcre: "/ 675: | 676: | 681: /"; content: " 0x2A "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001776; sid: 5001776; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x2C - Specified version of key is not available"; pcre: "/ 675: | 676: | 681: /"; content: " 0x2C "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001777; sid: 5001777; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x2D - Service key not available"; pcre: "/ 675: | 676: | 681: /"; content: " 0x2D "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001778; sid: 5001778; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x2E - Mutual authentication failed"; pcre: "/ 675: | 676: | 681: /"; content: " 0x2E "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001779; sid: 5001779; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x2F - Incorrect message direction"; pcre: "/ 675: | 676: | 681: /"; content: " 0x2F "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001780; sid: 5001780; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x30 - Alternative authentication method required"; pcre: "/ 675: | 676: | 681: /"; content: " 0x30 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001781; sid: 5001781; rev:1;)
alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x31 - Incorrect sequence number in message"; pcre: "/ 675: | 676: | 681: /"; content: " 0x31 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001782; sid: 5001782; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x32 - Inappropriate type of checksum in message"; pcre: "/ 675: | 676: | 681: /"; content: " 0x32 "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001783; sid: 5001783; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x3C - Generic error"; pcre: "/ 675: | 676: | 681: /"; content: " 0x3C "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001784; sid: 5001784; rev:1;)
#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Windows DC Logon Failure - Brute force 0x3D - Field is too long for this implementation"; pcre: "/ 675: | 676: | 681: /"; content: " 0x3D "; classtype: unsuccessful-user; program: Security|Security-Auditing; after: track by_src, count 5, seconds 300; threshold: type limit, track by_src, count 5, seconds 300; parse_src_ip: 1; reference: url,wiki.quadrantsec.com/bin/view/Main/5001785; sid: 5001785; rev:1;) 
# Account "re-enabled" via flowbit (12/03/2013) 

##alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] User account created [FLOWBIT SET]"; content: " 4720: "; program: Security|Security-Auditing; classtype: successful-user; flowbits: set, created_enabled, 30; flowbits: noalert; reference: url,wiki.quadrantsec.com/bin/view/Main/5001880; sid: 5001880; rev:2;)
##alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg:"[WINDOWS-AUTH] User account re-enabled"; content: " 4722: "; content:! "$" ;program: Security|Security-Auditing; flowbits: isnotset, by_src, created_enabled; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5001881; sid: 5001881; rev:2;)

# Rule added by Brian Echeverry ( becheverry@quadrantsec.com) - 02/21/2014
# Disabled by default.  Possible flowbit rule canidate (?)

#alert syslog $EXTERNAL_NET any -> $HOME_NET any (msg: "[WINDOWS-AUTH] Account locked out (ADMINISTRATOR)"; pcre: "/ 644: | 4740: /"; content: "administrator"; nocase; classtype: unsuccessful-user; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001978; sid: 5001978; rev:1;) 

# You'll want to populate the "WINDOWS_DOMAINS" before enabling this rule. 
# Champ Clark - 03/03/2014

#alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-AUTH] Pass-The-Hash detected!"; pcre: "/ 4624: | 4625: /"; content: "Logon Type|3a| 3 "; content: "Authentication Package|3a| NTLM "; content:!"ANONYMOUS LOGON"; meta_content:!"Domain|3a| ",$WINDOWS_DOMAINS; meta_nocase; program: Security|Security-Auditing; parse_src_ip: 1; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5002017; reference: url, http://en.wikipedia.org/wiki/Pass_the_hash; sid: 5002017; rev:2;)

# Records _all_ RDP sessions

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MISC] RDP / Logon type 10"; pcre: "/ 528: | 4624: /"; content: "Logon Type|3a| 10 "; program: Security|Security-Auditing; parse_src_ip: 1; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5002015; sid: 5002015; rev:1;)
#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MISC] Logon attempt using explicit credentials; pcre: "/ 552: | 4648: /"; content:!"Network Address|3a| - "; content:!"Port|3a| - "; content:!"Target Server Name|3a| localhost"; program: Security|Security-Auditing; parse_src_ip: 1; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5002018; sid: 5002018; rev:1;)


