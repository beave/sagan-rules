# Sagan msapi-azuread-bluedot.rules
# Copyright (c) 2009-2020. Quadrant Information Security <www.quadrantsec.com>
# All rights reserved.
#
# Please submit any custom rules or ideas to sagan-submit@quadrantsec.com or the sagan-sigs mailing list
#
#*************************************************************
#  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
#  following conditions are met:
#
#  * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
#    disclaimer.
#  * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the
#    following disclaimer in the documentation and/or other materials provided with the distribution.
#  * Neither the name of the nor the names of its contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#*************************************************************
#
# These rules work best with a JSON input map.  See the "msapi" mapping.  See the Sagan
# JSON documentation for more information
#

# Catch "all" rule...
#
# alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Catch all Bluedot listed IP address event"; json_content: "Workload", "AzureActiveDirectory"; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004821; sid:5004822; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Login from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "UserLoggedIn"; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004823; sid:5004823; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] App role assignment grant from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add app role assignment grant to user."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004824; sid:5004824; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] App role assignment grant from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add app role assignment grant to user."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004825; sid:5004825; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Add delegate permission grant from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add delegated permission grant."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004826; sid:5004826; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Device added from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add device."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004827; sid:5004827; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Group added from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add group."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004828; sid:5004828; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Member add to group from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add member to group."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004829; sid:5004829; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Member add to role from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add member to role."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004830; sid:5004830; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Owner added to group from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add owner to group."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004831; sid:5004831; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Registered owner added to device from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add registered owner to device."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004832; sid:5004832; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Registered users added to device from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add registered users to device."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004857; sid:5004857; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Added service principal from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add service principal."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004833; sid:5004833; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] User added from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Add user."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004834; sid:5004834; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Change user license from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Change user license."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004835; sid:5004835; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Change user password from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Change user password."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004836; sid:5004836; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Consent to application from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Consent to application."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004837; sid:5004837; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Application password created for user from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Create application password for user."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004838; sid:5004838; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Device deleted from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Create application password for user."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004839; sid:5004839; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] User deleted from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Delete user."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004840; sid:5004840; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Account disabled from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Disable account."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004841; sid:5004841; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Strong authentication enabled from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Enable Strong Authentication."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004842; sid:5004842; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Account enabled from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Enable account."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004843; sid:5004843; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Hard delete application from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Hard Delete application."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004844; sid:5004844; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Remove member from group from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Remove member from group."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004845; sid:5004845; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Remove owner from group from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Remove member from group."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004846; sid:5004846; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Password reset from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Reset user password."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004847; sid:5004847; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] User restored from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Restore user."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004848; sid:5004848; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Company information set from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Set Company Information."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004849; sid:5004849; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Update StsRefreshTokenValidFrom Timestamp from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Update StsRefreshTokenValidFrom Timestamp."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004850; sid:5004850; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Device updated from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Update device."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004851; sid:5004851; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Group updated from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Update group."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004852; sid:5004852; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Policy updated from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Update policy."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004853; sid:5004853; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] Service principal updated from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Update service principal."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004854; sid:5004854; rev:1;)

alert any $HOME_NET any -> $EXTERNAL_NET any (msg: "[MSAPI-AZURE-AD-BLUEDOT] User updated from Bluedot listed IP address"; json_content: "Workload", "AzureActiveDirectory"; json_content: "Operation", "Update user."; bluedot: type ip_reputation, track by_src, none, Malicious,Tor,Honeypot,Proxy; classtype: successful-user; reference: url,wiki.quadrantsec.com/bin/view/Main/5004855; sid:5004855; rev:1;)

